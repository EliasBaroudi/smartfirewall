![SMARTFIREWALL](./screenshots/banner.png)

SmartFireWall is a network traffic analyzer and firewall rules generator. Its main purpose is to **help with firewall configuration**. It reads PCAP/PCAPNG files, analyzes network flows, generates CSV/SQLite/Elasticsearch outputs, and can visualize traffic using AfterGlow.  

!! The generated graphs from AfterGlow or Elasticsearch are **intended to guide your analysis**. You should perform **careful review and thoughtful consideration** of the visualizations to create coherent and effective firewall rules.

## Features

- Analyze PCAP/PCAPNG files from ./data/
- Automatically generate firewall rules
- Export results to CSV, SQLite, or Elasticsearch
- Visualize network flows with AfterGlow (Linux only)
- Fully configurable via config.py
- Docker-ready for easy deployment

## Installation

1. Clone the repository:

   ```bash
   git clone https://github.com/EliasBaroudi/smartfirewall/
   cd smartfirewall
   ```

3. Install Python dependencies:

   ```bash
   pip install -r requirements.txt
   ```
   
4. Place your PCAP files in the ./data/ directory.

## Optional Dependencies

### AfterGlow (Linux only)

AfterGlow is used to generate network visualization graphs.

1. Download `afterglow.pl` from the official repository:
   https://github.com/zrlram/afterglow

2. Place `afterglow.pl` in the project root directory (next to `script.py`).

3. Make sure Perl and Graphviz (`neato`) are installed on your system.

---

### Elasticsearch

If `user_elastic = True` in `config.py`, you must run an Elasticsearch instance.

You can deploy Elasticsearch using Docker.  
Official documentation:  
https://www.elastic.co/docs/deploy-manage/deploy/self-managed/install-elasticsearch-with-docker

## Configuration

- Edit config.py to adjust:
  - CSV, SQLite, Elasticsearch, or AfterGlow features
  - Input/output directories
  - Thresholds for ports and servers
- Customize AfterGlow appearance in sample.properties.

## Usage

### Local Python Execution

```bash
python script.py
```

### Using Docker

1. Create a Docker network:

```bash
docker network create smfw_lan
```

2. Launch Elasticsearch via Docker Compose (Elasticsearch and smartfirewall need to be in the same network):

```bash
docker-compose up -d
```

Note : 
   - If your are using Elasticsearch outside docker you'll have to specify the correct url in config.py
   - You'll need to create a Data View to use the generated indexs

![DataView](./screenshots/dataview.png)

3. Run SmartFireWall container:

```bash
docker run --rm --network=smfw_lan -it -v ./:/app smartfirewall python script.py
```

## Output

- CSV logs: ./output/YYYY-MM-DD_HH-MM/csv.csv
- SQLite database: ./output/YYYY-MM-DD_HH-MM/db.db
- Elasticsearch index: smart_fw_YYYY-MM-DD_HH-MM
- Firewall rules: ./output/YYYY-MM-DD_HH-MM/rules.txt
- AfterGlow visualization: ./output/YYYY-MM-DD_HH-MM/graph.png (Linux only)

## Example 

1. Running the script

   ```
   docker run --rm --network=smfw_lan -it -v ./:/app smartfirewall python script.py
   
   ####### LOADING FILES #######
   File : ./data/ultimate_pcap.pcapng
   [*] Loading.
   [+] Done
   
   
   ####### READING PACKETS #######
   [================================================= ] 100%
   
   ####### EXPORTING DATA #######
   [+] CSV exported to: ./output/08-02-2026_21-09/csv.csv
   [+] Database exported to: ./output/08-02-2026_21-09/db.db
   [+] Index created successfully
   [+] Visualization exported to: ./output/08-02-2026_21-09/graph.png
   
   
   ####### OPTIMIZING RULES #######
   [*] Removing rules where source and destination IPs are in the same network
   [*] Grouping rules by network CIDR
   
   
   ####### GENERATING RULES #######
   [+] Rules file saved to: ./output/08-02-2026_21-09/rules.txt
   ```

2. rules.txt

   ```
   # Generated by SmartFireWall on Sun Feb  8 21:09:30 2026
   # Files : ./data/ultimate_pcap.pcapng
   
   # User conf : 
   # config.dir_input : ./data/
   # config.dir_output : ./output/
   # config.dir_output : ./output/
   # config.user_csv : True
   # config.user_db : True
   # config.user_elastic : True
   # config.auto_any_rules : False
   # config.remove_same_network : True
   # config.max_uniques_ports : 20
   # config.tcp_random_range : range(32768, 65536)
   # config.global_port_threshold : 20
   # config.public_server_threshold : 15
   
   *filter
   :INPUT ACCEPT [0:0]
   :FORWARD ACCEPT [0:0]
   :OUTPUT ACCEPT [0:0]
   -A INPUT -s 172.16.81.99 -d 172.16.80.10 -p tcp --dport 53 -j ACCEPT
   -A INPUT -s 172.16.81.99 -d 172.16.80.10 -p udp --dport 389 -j ACCEPT
   -A INPUT -s 192.168.3.53 -d 172.16.80.10 -p tcp -m multiport --dports 53,88 -j ACCEPT
   -A INPUT -s 192.168.121.0/24 -d 224.0.0.102 -p udp --dport 1985 -j ACCEPT
   ...
   -A INPUT -j DROP
   COMMIT
   #Completed on Sun Feb  8 21:09:30 2026
   ```

3. graph.png

![Graph](./screenshots/graph.png)

4. Visualizations in Elasticsearch

![Graph](./screenshots/dashboard.png)
